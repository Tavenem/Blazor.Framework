const e=new RegExp("\\s","g");class t{constructor(e,t){this._keyOptions={},this._observedChildren=[],this._regexOptions=[],this._dotNetRef=e,this._options=t}connect(e){if(this._options){if(!this._options.keys)throw"_options.keys: array of IKeyOptions expected";this._element=e,this._keyOptions={},this._regexOptions=[];for(const e of this._options.keys)e&&e.key&&this.setKeyOption(e);this.attachHandlers(this._element)}}disconnect(){this._element&&this.detachHandlers(this._element)}setKeyOption(t){t.key.length>2&&t.key.startsWith("/")&&t.key.endsWith("/")?(t.regex=new RegExp(t.key.substring(1,t.key.length-1)),this._regexOptions.push(t)):this._keyOptions[t.key.toLowerCase()]=t,t.preventDown=(t.preventDown||"none").replace(e,"").toLowerCase(),t.preventUp=(t.preventUp||"none").replace(e,"").toLowerCase(),t.stopDown=(t.stopDown||"none").replace(e,"").toLowerCase(),t.stopUp=(t.stopUp||"none").replace(e,"").toLowerCase()}attachHandlers(e){this._observedChildren&&this._observedChildren.indexOf(e)>-1||(e.keyListener=this,e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp),this._observedChildren.push(e))}detachHandlers(e){e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),this._observedChildren=this._observedChildren.filter((t=>t!==e))}matchesKeyCombination(e,t){if(!e||"none"===e)return!1;if("any"===e)return!0;var n=t.shiftKey,o=t.ctrlKey,s=t.altKey,r=t.metaKey,i=n||o||s||r;return!(!i||"key+any"!==e)||(!(i||!e.includes("key+none"))||!!i&&e.includes(`key${n?"+shift":""}${o?"+ctrl":""}${s?"+alt":""}${r?"+meta":""}`))}onKeyDown(e){var t=this.keyListener;if(!t)return;if(!(e instanceof KeyboardEvent))return;const n=e.key.toLowerCase();let o=!1;if(t._keyOptions.hasOwnProperty(n)){const s=t._keyOptions[n];e.target!=e.currentTarget&&s.targetOnly||(t.processKeyDown(e,s),s.subscribeDown&&(o=!0))}for(const n of t._regexOptions)e.target!=e.currentTarget&&n.targetOnly||!n.regex||!n.regex.test(e.key)||(t.processKeyDown(e,n),n.subscribeDown&&(o=!0));if(o){const n=t.toKeyboardEventArgs(e);n.Type="keydown",t._dotNetRef.invokeMethodAsync("OnKeyDown",n)}}onKeyUp(e){var t=this.keyListener;if(!t)return;if(!(e instanceof KeyboardEvent))return;const n=e.key.toLowerCase();let o=!1;if(t._keyOptions.hasOwnProperty(n)){const s=t._keyOptions[n];t.processKeyUp(e,s),s.subscribeUp&&(o=!0)}for(const s of t._regexOptions)s.regex&&s.regex.test(n)&&(t.processKeyUp(e,s),s.subscribeUp&&(o=!0));if(o){const n=t.toKeyboardEventArgs(e);n.Type="keyup",t._dotNetRef.invokeMethodAsync("OnKeyUp",n)}}processKeyDown(e,t){this.matchesKeyCombination(t.preventDown,e)&&e.preventDefault(),this.matchesKeyCombination(t.stopDown,e)&&e.stopPropagation()}processKeyUp(e,t){this.matchesKeyCombination(t.preventUp,e)&&e.preventDefault(),this.matchesKeyCombination(t.stopUp,e)&&e.stopPropagation()}toKeyboardEventArgs(e){return{Key:e.key,Code:e.code,Location:e.location,Repeat:e.repeat,CtrlKey:e.ctrlKey,ShiftKey:e.shiftKey,AltKey:e.altKey,MetaKey:e.metaKey}}}function n(e,n,o){if(!n)return;const s=document.getElementById(n);s&&(s.keyListener||(s.keyListener=new t(e,o)),s.keyListener.connect(s))}function o(e){var t=document.getElementById(e);t&&t.keyListener&&t.keyListener.disconnect()}function s(e,t){const n=document.getElementById(e);n&&n.keyListener&&n.keyListener.setKeyOption(t)}export{o as disconnectKeyEvent,n as listenForKeyEvent,s as updateKeyEvent};
//# sourceMappingURL=tavenem-keylistener.js.map
