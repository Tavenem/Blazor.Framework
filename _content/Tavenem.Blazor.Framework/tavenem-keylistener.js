!function(){const e={};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();const e=new RegExp("\\s","g");class t{constructor(e,t){this._keyOptions={},this._observedChildren=[],this._regexOptions=[],this._dotNetRef=e,this._options=t}connect(e){if(this._options){if(!this._options.keys)throw"_options.keys: array of IKeyOptions expected";this._element=e,this._keyOptions={},this._regexOptions=[];for(const e of this._options.keys)e&&e.key&&this.setKeyOption(e);this.attachHandlers(this._element)}}disconnect(){this._element&&this.detachHandlers(this._element)}setKeyOption(t){t.key.length>2&&t.key.startsWith("/")&&t.key.endsWith("/")?(t.regex=new RegExp(t.key.substring(1,t.key.length-1)),this._regexOptions.push(t)):this._keyOptions[t.key.toLowerCase()]=t,t.preventDown=(t.preventDown||"none").replace(e,"").toLowerCase(),t.preventUp=(t.preventUp||"none").replace(e,"").toLowerCase(),t.stopDown=(t.stopDown||"none").replace(e,"").toLowerCase(),t.stopUp=(t.stopUp||"none").replace(e,"").toLowerCase()}attachHandlers(e){this._observedChildren&&this._observedChildren.indexOf(e)>-1||(e.keyListener=this,e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp),this._observedChildren.push(e))}detachHandlers(e){e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),this._observedChildren=this._observedChildren.filter((t=>t!==e))}matchesKeyCombination(e,t){if(!e||"none"===e)return!1;if("any"===e)return!0;var n=t.shiftKey,s=t.ctrlKey,o=t.altKey,r=t.metaKey,i=n||s||o||r;return!(!i||"key+any"!==e)||(!(i||!e.includes("key+none"))||!!i&&e.includes(`key${n?"+shift":""}${s?"+ctrl":""}${o?"+alt":""}${r?"+meta":""}`))}onKeyDown(e){var t=this.keyListener;if(!t)return;if(!(e instanceof KeyboardEvent))return;const n=e.key.toLowerCase();let s=!1;if(t._keyOptions.hasOwnProperty(n)){const o=t._keyOptions[n];e.target!=e.currentTarget&&o.targetOnly||(t.processKeyDown(e,o),o.subscribeDown&&(s=!0))}for(const n of t._regexOptions)e.target!=e.currentTarget&&n.targetOnly||!n.regex||!n.regex.test(e.key)||(t.processKeyDown(e,n),n.subscribeDown&&(s=!0));if(s){const n=t.toKeyboardEventArgs(e);n.Type="keydown",t._dotNetRef.invokeMethodAsync("OnKeyDown",n)}}onKeyUp(e){var t=this.keyListener;if(!t)return;if(!(e instanceof KeyboardEvent))return;const n=e.key.toLowerCase();let s=!1;if(t._keyOptions.hasOwnProperty(n)){const o=t._keyOptions[n];t.processKeyUp(e,o),o.subscribeUp&&(s=!0)}for(const o of t._regexOptions)o.regex&&o.regex.test(n)&&(t.processKeyUp(e,o),o.subscribeUp&&(s=!0));if(s){const n=t.toKeyboardEventArgs(e);n.Type="keyup",t._dotNetRef.invokeMethodAsync("OnKeyUp",n)}}processKeyDown(e,t){this.matchesKeyCombination(t.preventDown,e)&&e.preventDefault(),this.matchesKeyCombination(t.stopDown,e)&&e.stopPropagation()}processKeyUp(e,t){this.matchesKeyCombination(t.preventUp,e)&&e.preventDefault(),this.matchesKeyCombination(t.stopUp,e)&&e.stopPropagation()}toKeyboardEventArgs(e){return{Key:e.key,Code:e.code,Location:e.location,Repeat:e.repeat,CtrlKey:e.ctrlKey,ShiftKey:e.shiftKey,AltKey:e.altKey,MetaKey:e.metaKey}}}function n(e,n,s){if(!n)return;const o=document.getElementById(n);o&&(o.keyListener||(o.keyListener=new t(e,s)),o.keyListener.connect(o))}function s(e){var t=document.getElementById(e);t&&t.keyListener&&t.keyListener.disconnect()}function o(e,t){const n=document.getElementById(e);n&&n.keyListener&&n.keyListener.setKeyOption(t)}export{s as disconnectKeyEvent,n as listenForKeyEvent,o as updateKeyEvent};
//# sourceMappingURL=tavenem-keylistener.js.map
