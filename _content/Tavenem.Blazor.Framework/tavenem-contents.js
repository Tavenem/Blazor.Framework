!function(){const n={};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,n)}catch(n){}globalThis.process={env:n}}();class n extends HTMLElement{constructor(){super(),this._headings=[],this._mutationObserver=new MutationObserver((n=>{let e=!1;for(const t of n)if("childList"===t.type){for(const n of t.removedNodes)(n instanceof HTMLHeadingElement||n instanceof HTMLElement&&n.classList.contains("tav-heading"))&&!("hideFromContents"in n.dataset)&&null==n.closest("tf-popover, .dialog-container, .editor")&&(e=!0);for(const n of t.addedNodes)(n instanceof HTMLHeadingElement||n instanceof HTMLElement&&n.classList.contains("tav-heading"))&&!("hideFromContents"in n.dataset)&&null==n.closest("tf-popover, .dialog-container, .editor")&&(e=!0)}else"attributes"===t.type&&(t.target instanceof HTMLHeadingElement||t.target instanceof HTMLElement&&t.target.classList.contains("tav-heading"))&&null==t.target.closest("tf-popover, .dialog-container, .editor")&&(e=!0);e&&this.refresh()}))}connectedCallback(){const n=this.attachShadow({mode:"open"}),e=document.createElement("style");e.innerHTML=":host {\n    display: flex;\n    flex-direction: column;\n    margin-top: 1rem;\n    max-width:15em;\n    overflow: auto;\n    padding-left: .75em;\n    padding-right: .75em;\n    padding-top: .25em;\n    scrollbar-color: var(--tavenem-color-scrollbar) transparent;\n    scrollbar-width: thin;\n}\n\n@media print {\n    :host {\n        display: none;\n    }\n}\n\n::-webkit-scrollbar {\n    height: .5rem;\n    width: .5rem;\n    z-index: 1;\n}\n\n::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--tavenem-color-scrollbar);\n    border-radius: 1px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--tavenem-color-scrollbar-hover);\n}\n\nnav.contents-list {\n    color: var(--tavenem-color-text-secondary);\n    display: flex;\n    flex-direction: column;\n    list-style: none;\n    overflow: auto;\n    padding-bottom: .25em;\n    padding-top: .25em;\n    position: relative;\n    scrollbar-gutter: stable;\n    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n}\n\n:host(.empty) nav.contents-list {\n    display: none;\n}\n\nnav.contents-list > * {\n    align-items: center;\n    background-color: transparent;\n    box-sizing: border-box;\n    color: inherit;\n    column-gap: .5em;\n    display: flex;\n    flex: 0 0 auto;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    list-style: none;\n    padding-bottom: .25em;\n    padding-inline-end: .25em;\n    padding-inline-start: .25em;\n    padding-top: .25em;\n    position: relative;\n    text-align: start;\n    text-decoration: none;\n    transition: background-color 150ms cubic-bezier(.4,0,.2,1) 0ms;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > *:focus-visible,\nnav.contents-list > *:hover {\n    background-color: transparent;\n    color: inherit;\n}\n\nnav.contents-list > a {\n    border: 0;\n    border-radius: 0;\n    cursor: pointer;\n    margin: 0;\n    outline: 0;\n    transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n    user-select: none;\n    vertical-align: middle;\n    -webkit-appearance: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > a:hover,\nnav.contents-list > a:focus {\n    background-color: var(--tavenem-color-primary-hover);\n}\n\nnav.contents-list > a.active {\n    background-color: var(--tavenem-color-primary-hover);\n    border-inline-start: 1px solid var(--tavenem-color-primary);\n    color: var(--tavenem-color-primary);\n    padding-inline-start: calc(.25em - 1px);\n}\n\nnav.contents-list > a.active:hover,\nnav.contents-list > a.active:focus {\n    background-color: var(--tavenem-color-primary-hover-bright);\n}\n\nslot .default-title {\n    background-color: inherit;\n    font-size: .875em;\n    font-weight: var(--tavenem-font-weight-bold);\n    position: sticky;\n    top: 0;\n    z-index: 1;\n}\n\n:host(.empty) slot .default-title {\n    display: none;\n}",n.appendChild(e);const t=document.createElement("slot");n.appendChild(t);const o=document.createElement("span");o.classList.add("default-title"),o.textContent="Contents",t.appendChild(o);const i=document.createElement("nav");i.classList.add("contents-list"),n.appendChild(i),this.refresh(),this._mutationObserver.observe(this.parentNode||document,{attributeFilter:["data-heading-level","data-heading-title","data-hide-from-contents"],childList:!0,subtree:!0}),document.addEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.addEventListener("resize",this.handleScrollSpy.bind(this),!0)}disconnectedCallback(){document.removeEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.removeEventListener("resize",this.handleScrollSpy.bind(this),!0)}static documentPositionComparator(n,e){if(n===e)return 0;var t=n.compareDocumentPosition(e);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}refresh(){const e=this.shadowRoot;if(!e)return;const t=e.querySelector("nav.contents-list");if(!t)return;const o=this.parentNode||document;this._headings=Array.from(o.querySelectorAll("h1,h2,h3,h4,h5,h6,.tav-heading")).filter((n=>n instanceof HTMLElement&&!("hideFromContents"in n.dataset)&&null==n.closest("tf-popover, .dialog-container, .editor"))).map(((n,e)=>{const t=n;return t.headingLevel=Number.parseInt(n.tagName.startsWith("H")?n.tagName.substring(1):n.getAttribute("data-heading-level")||"0"),t.headingTitle=n.getAttribute("data-heading-title")||n.textContent||`Heading ${e.toString()}`,t})).sort(n.documentPositionComparator);const i=[];if(this._headings.length>0){const n=parseInt(this.dataset.minHeadings||"3");if(n>0&&this._headings.length>=n){const n=parseInt(this.dataset.maxLevel||"0"),e=parseInt(this.dataset.maxLevelOffset||"2"),t=this._headings.filter((n=>n.headingLevel>0)).reduce(((n,e)=>n&&n.headingLevel<e.headingLevel?n:e)),o=t?t.headingLevel:0,a=0===o?0:this._headings.reduce(((n,e)=>n&&n.headingLevel>e.headingLevel?n:e)).headingLevel;for(const t of this._headings){if(n>0&&(0==t.headingLevel||t.headingLevel>n))continue;const s=t.headingLevel?t.headingLevel-o:a+1;if(e>=0&&s>e)continue;const r=document.createElement("a");r.heading=t,t.id?r.href=window.location.origin+window.location.pathname+`#${t.id}`:r.addEventListener("click",this.scrollToHeading.bind(this,t)),o>0&&s>0&&(r.style.paddingInlineStart=.5*s+"rem"),r.textContent=t.headingTitle,i.push(r)}}}t.replaceChildren(...i),0===i.length?this.classList.add("empty"):this.classList.remove("empty")}handleScrollSpy(){const n=this.shadowRoot;if(!n)return;const e=n.querySelector("nav.contents-list");if(!e)return;if(0===this._headings.length){for(const n of e.children)n.classList.remove("active");return void delete this._activeHeading}let t,o,i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;const s=.8*window.innerHeight;for(let n=0;n<this._headings.length;n++){const e=this._headings[n],r=e.getBoundingClientRect();r.top<0?r.top>i&&(i=r.top,t=e):r.top<s&&r.top<a&&(a=r.top,o=e)}const r=o||t;if(r){if(r!=this._activeHeading){this._activeHeading=r;for(const n of e.children)n.heading===r?n.classList.add("active"):n.classList.remove("active")}}else{for(const n of e.children)n.classList.remove("active");delete this._activeHeading}}scrollToHeading(n){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.location.hash&&window.location.hash.length&&history.replaceState(null,"",window.location.pathname)}}export{n as TavenemContentsHTMLElement};
//# sourceMappingURL=tavenem-contents.js.map
