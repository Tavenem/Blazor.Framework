!function(){const e={};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();class e extends HTMLElement{constructor(){super(),this._headings=[],this._mutationObserver=new MutationObserver((e=>{let n=!1;for(const t of e)if("childList"===t.type){if(t.removedNodes.length){n=!0;break}for(const e of t.addedNodes)if((e instanceof HTMLHeadingElement||e instanceof HTMLElement&&e.classList.contains("tav-heading"))&&!("hideFromContents"in e.dataset)&&null==e.closest("tf-popover, .dialog-container, .editor")){n=!0;break}if(n)break}else if("attributes"===t.type&&(t.target instanceof HTMLHeadingElement||t.target instanceof HTMLElement&&t.target.classList.contains("tav-heading"))&&null==t.target.closest("tf-popover, .dialog-container, .editor")){n=!0;break}n&&this.refresh()}))}connectedCallback(){const e=this.attachShadow({mode:"open"}),n=document.createElement("style");n.innerHTML=":host {\n    display: flex;\n    flex-direction: column;\n    margin-top: 1rem;\n    max-width:15em;\n    overflow: auto;\n    padding-left: .75em;\n    padding-right: .75em;\n    padding-top: .25em;\n    scrollbar-color: var(--tavenem-color-scrollbar) transparent;\n    scrollbar-width: thin;\n}\n\n@media print {\n    :host {\n        display: none;\n    }\n}\n\n::-webkit-scrollbar {\n    height: .5rem;\n    width: .5rem;\n    z-index: 1;\n}\n\n::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--tavenem-color-scrollbar);\n    border-radius: 1px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--tavenem-color-scrollbar-hover);\n}\n\nnav.contents-list {\n    color: var(--tavenem-color-text-secondary);\n    display: flex;\n    flex-direction: column;\n    list-style: none;\n    overflow: auto;\n    padding-bottom: .25em;\n    padding-top: .25em;\n    position: relative;\n    scrollbar-gutter: stable;\n    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n}\n\n:host(.empty) nav.contents-list {\n    display: none;\n}\n\nnav.contents-list > * {\n    align-items: center;\n    background-color: transparent;\n    box-sizing: border-box;\n    color: inherit;\n    column-gap: .5em;\n    display: flex;\n    flex: 0 0 auto;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    list-style: none;\n    padding-bottom: .25em;\n    padding-inline-end: .25em;\n    padding-inline-start: .25em;\n    padding-top: .25em;\n    position: relative;\n    text-align: start;\n    text-decoration: none;\n    transition: background-color 150ms cubic-bezier(.4,0,.2,1) 0ms;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > *:focus-visible,\nnav.contents-list > *:hover {\n    background-color: transparent;\n    color: inherit;\n}\n\nnav.contents-list > a {\n    border: 0;\n    border-radius: 0;\n    cursor: pointer;\n    margin: 0;\n    outline: 0;\n    transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n    user-select: none;\n    vertical-align: middle;\n    -webkit-appearance: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > a:hover,\nnav.contents-list > a:focus {\n    background-color: var(--tavenem-color-primary-hover);\n}\n\nnav.contents-list > a.active {\n    background-color: var(--tavenem-color-primary-hover);\n    border-inline-start: 1px solid var(--tavenem-color-primary);\n    color: var(--tavenem-color-primary);\n    padding-inline-start: calc(.25em - 1px);\n}\n\nnav.contents-list > a.active:hover,\nnav.contents-list > a.active:focus {\n    background-color: var(--tavenem-color-primary-hover-bright);\n}\n\nslot .default-title {\n    background-color: inherit;\n    font-size: .875em;\n    font-weight: var(--tavenem-font-weight-bold);\n    position: sticky;\n    top: 0;\n    z-index: 1;\n}\n\n:host(.empty) slot .default-title {\n    display: none;\n}",e.appendChild(n);const t=document.createElement("slot");e.appendChild(t);const i=document.createElement("span");i.classList.add("default-title"),i.textContent="Contents",t.appendChild(i);const o=document.createElement("nav");o.classList.add("contents-list"),e.appendChild(o),this.refresh(),this._mutationObserver.observe(this.parentNode||document,{attributeFilter:["data-heading-level","data-heading-title","data-hide-from-contents"],childList:!0,subtree:!0}),document.addEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.addEventListener("resize",this.handleScrollSpy.bind(this),!0)}disconnectedCallback(){document.removeEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.removeEventListener("resize",this.handleScrollSpy.bind(this),!0)}static documentPositionComparator(e,n){if(e===n)return 0;var t=e.compareDocumentPosition(n);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}refresh(){const n=this.shadowRoot;if(!n)return;const t=n.querySelector("nav.contents-list");if(!t)return;const i=this.parentNode||document;this._headings=Array.from(i.querySelectorAll("h1,h2,h3,h4,h5,h6,.tav-heading")).filter((e=>e instanceof HTMLElement&&!("hideFromContents"in e.dataset)&&null==e.closest("tf-popover, .dialog-container, .editor"))).map(((e,n)=>{const t=e;return t.headingLevel=Number.parseInt(e.tagName.startsWith("H")?e.tagName.substring(1):e.getAttribute("data-heading-level")||"0"),t.headingTitle=e.getAttribute("data-heading-title")||e.textContent||`Heading ${n.toString()}`,t})).sort(e.documentPositionComparator);const o=[];if(this._headings.length>0){const e=parseInt(this.dataset.minHeadings||"3");if(e>0&&this._headings.length>=e){const e=parseInt(this.dataset.maxLevel||"0"),n=parseInt(this.dataset.maxLevelOffset||"2"),t=this._headings.filter((e=>e.headingLevel>0)).reduce(((e,n)=>e&&e.headingLevel<n.headingLevel?e:n)),i=t?t.headingLevel:0,a=0===i?0:this._headings.reduce(((e,n)=>e&&e.headingLevel>n.headingLevel?e:n)).headingLevel;for(const t of this._headings){if(e>0&&(0==t.headingLevel||t.headingLevel>e))continue;const r=t.headingLevel?t.headingLevel-i:a+1;if(n>=0&&r>n)continue;const s=document.createElement("a");s.heading=t,t.id?s.href=window.location.origin+window.location.pathname+`#${t.id}`:s.addEventListener("click",this.scrollToHeading.bind(this,t)),i>0&&r>0&&(s.style.paddingInlineStart=.5*r+"rem"),s.textContent=t.headingTitle,o.push(s)}}}t.replaceChildren(...o),0===o.length?this.classList.add("empty"):this.classList.remove("empty")}handleScrollSpy(){const e=this.shadowRoot;if(!e)return;const n=e.querySelector("nav.contents-list");if(!n)return;if(0===this._headings.length){for(const e of n.children)e.classList.remove("active");return void delete this._activeHeading}let t,i,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;const r=.8*window.innerHeight;for(let e=0;e<this._headings.length;e++){const n=this._headings[e],s=n.getBoundingClientRect();s.top<0?s.top>o&&(o=s.top,t=n):s.top<r&&s.top<a&&(a=s.top,i=n)}const s=i||t;if(s){if(s!=this._activeHeading){this._activeHeading=s;for(const e of n.children)e.heading===s?e.classList.add("active"):e.classList.remove("active")}}else{for(const e of n.children)e.classList.remove("active");delete this._activeHeading}}scrollToHeading(e){e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.location.hash&&window.location.hash.length&&history.replaceState(null,"",window.location.pathname)}}export{e as TavenemContentsHTMLElement};
//# sourceMappingURL=tavenem-contents.js.map
