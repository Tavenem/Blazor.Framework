!function(){const e={};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();class e extends HTMLElement{constructor(){super(),this._headings=[],this._mutationObserver=new MutationObserver((e=>{let t=!1;for(const n of e)if("childList"===n.type){for(const e of n.removedNodes)if((e instanceof HTMLHeadingElement||e instanceof HTMLElement&&e.classList.contains("tav-heading"))&&!("hideFromContents"in e.dataset)&&null==e.closest("tf-popover, .dialog-container, .editor")){const n=this._headings.indexOf(e);n>=0&&(this._headings.splice(n,1),t=!0)}for(const e of n.addedNodes)if((e instanceof HTMLHeadingElement||e instanceof HTMLElement&&e.classList.contains("tav-heading"))&&!("hideFromContents"in e.dataset)&&null==e.closest("tf-popover, .dialog-container, .editor")){if(-1==this._headings.indexOf(e)){const n=e;n.headingLevel=Number.parseInt(n.tagName.startsWith("H")?n.tagName.substring(1):n.getAttribute("data-heading-level")||"0"),n.headingTitle=n.getAttribute("data-heading-title")||n.textContent||`Heading ${this._headings.length.toString()}`,this._headings.push(n),t=!0}}}else if("attributes"===n.type&&(n.target instanceof HTMLHeadingElement||n.target instanceof HTMLElement&&n.target.classList.contains("tav-heading"))&&null==n.target.closest("tf-popover, .dialog-container, .editor")){const e="hideFromContents"in n.target.dataset,i=this._headings.indexOf(n.target);if(i>=0){if(e)this._headings.splice(i,1);else{const e=this._headings[i];e.headingLevel=Number.parseInt(e.tagName.startsWith("H")?e.tagName.substring(1):e.getAttribute("data-heading-level")||"0"),e.headingTitle=e.getAttribute("data-heading-title")||e.textContent||`Heading ${this._headings.length.toString()}`}t=!0}else if(!e){const e=n.target;e.headingLevel=Number.parseInt(e.tagName.startsWith("H")?e.tagName.substring(1):e.getAttribute("data-heading-level")||"0"),e.headingTitle=e.getAttribute("data-heading-title")||e.textContent||`Heading ${this._headings.length.toString()}`,this._headings.push(e),t=!0}}t&&this.refreshHeadings()}))}connectedCallback(){const e=this.attachShadow({mode:"open"}),t=document.createElement("style");t.innerHTML=":host {\n    display: flex;\n    flex-direction: column;\n    margin-top: 1rem;\n    max-width:15em;\n    overflow: auto;\n    padding-left: .75em;\n    padding-right: .75em;\n    padding-top: .25em;\n    scrollbar-color: var(--tavenem-color-scrollbar) transparent;\n    scrollbar-width: thin;\n}\n\n@media print {\n    :host {\n        display: none;\n    }\n}\n\n::-webkit-scrollbar {\n    height: .5rem;\n    width: .5rem;\n    z-index: 1;\n}\n\n::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--tavenem-color-scrollbar);\n    border-radius: 1px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--tavenem-color-scrollbar-hover);\n}\n\nnav.contents-list {\n    color: var(--tavenem-color-text-secondary);\n    display: flex;\n    flex-direction: column;\n    list-style: none;\n    overflow: auto;\n    padding-bottom: .25em;\n    padding-top: .25em;\n    position: relative;\n    scrollbar-gutter: stable;\n    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n}\n\n:host(.empty) nav.contents-list {\n    display: none;\n}\n\nnav.contents-list > * {\n    align-items: center;\n    background-color: transparent;\n    box-sizing: border-box;\n    color: inherit;\n    column-gap: .5em;\n    display: flex;\n    flex: 0 0 auto;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    list-style: none;\n    padding-bottom: .25em;\n    padding-inline-end: .25em;\n    padding-inline-start: .25em;\n    padding-top: .25em;\n    position: relative;\n    text-align: start;\n    text-decoration: none;\n    transition: background-color 150ms cubic-bezier(.4,0,.2,1) 0ms;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > *:focus-visible,\nnav.contents-list > *:hover {\n    background-color: transparent;\n    color: inherit;\n}\n\nnav.contents-list > a {\n    border: 0;\n    border-radius: 0;\n    cursor: pointer;\n    margin: 0;\n    outline: 0;\n    transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n    user-select: none;\n    vertical-align: middle;\n    -webkit-appearance: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\nnav.contents-list > a:hover,\nnav.contents-list > a:focus {\n    background-color: var(--tavenem-color-primary-hover);\n}\n\nnav.contents-list > a.active {\n    background-color: var(--tavenem-color-primary-hover);\n    border-inline-start: 1px solid var(--tavenem-color-primary);\n    color: var(--tavenem-color-primary);\n    padding-inline-start: calc(.25em - 1px);\n}\n\nnav.contents-list > a.active:hover,\nnav.contents-list > a.active:focus {\n    background-color: var(--tavenem-color-primary-hover-bright);\n}\n\nslot .default-title {\n    background-color: inherit;\n    font-size: .875em;\n    font-weight: var(--tavenem-font-weight-bold);\n    position: sticky;\n    top: 0;\n    z-index: 1;\n}\n\n:host(.empty) slot .default-title {\n    display: none;\n}",e.appendChild(t);const n=document.createElement("slot");e.appendChild(n);const i=document.createElement("span");i.classList.add("default-title"),i.textContent="Contents",n.appendChild(i);const a=document.createElement("nav");a.classList.add("contents-list"),e.appendChild(a),this.getHeadings(),this.refreshHeadings(),this._mutationObserver.observe(this.parentNode||document,{attributeFilter:["data-heading-level","data-heading-title","data-hide-from-contents"],childList:!0,subtree:!0}),document.addEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.addEventListener("resize",this.handleScrollSpy.bind(this),!0)}disconnectedCallback(){document.removeEventListener("scroll",this.handleScrollSpy.bind(this),!0),window.removeEventListener("resize",this.handleScrollSpy.bind(this),!0)}static documentPositionComparator(e,t){if(e===t)return 0;var n=e.compareDocumentPosition(t);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0}refresh(){this.getHeadings(),this.refreshHeadings()}getHeadings(){const e=this.parentNode||document;this._headings=Array.from(e.querySelectorAll("h1,h2,h3,h4,h5,h6,.tav-heading")).filter((e=>e instanceof HTMLElement&&!("hideFromContents"in e.dataset)&&null==e.closest("tf-popover, .dialog-container, .editor"))).map(((e,t)=>{const n=e;return n.headingLevel=Number.parseInt(e.tagName.startsWith("H")?e.tagName.substring(1):e.getAttribute("data-heading-level")||"0"),n.headingTitle=e.getAttribute("data-heading-title")||e.textContent||`Heading ${t.toString()}`,n}))}handleScrollSpy(){const e=this.shadowRoot;if(!e)return;const t=e.querySelector("nav.contents-list");if(!t)return;if(0===this._headings.length){for(const e of t.children)e.classList.remove("active");return void delete this._activeHeading}let n,i,a=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;const o=.8*window.innerHeight;for(let e=0;e<this._headings.length;e++){const t=this._headings[e],r=t.getBoundingClientRect();r.top<0?r.top>a&&(a=r.top,n=t):r.top<o&&r.top<s&&(s=r.top,i=t)}const r=i||n;if(r){if(r!=this._activeHeading){this._activeHeading=r;for(const e of t.children)e.heading===r?e.classList.add("active"):e.classList.remove("active")}}else{for(const e of t.children)e.classList.remove("active");delete this._activeHeading}}refreshHeadings(){const t=this.shadowRoot;if(!t)return;const n=t.querySelector("nav.contents-list");if(!n)return;this._headings=this._headings.sort(e.documentPositionComparator);const i=[];if(this._headings.length>0){const e=parseInt(this.dataset.minHeadings||"3");if(e>0&&this._headings.length>=e){const e=parseInt(this.dataset.maxLevel||"0"),t=parseInt(this.dataset.maxLevelOffset||"2"),n=this._headings.filter((e=>e.headingLevel>0)).reduce(((e,t)=>e&&e.headingLevel<t.headingLevel?e:t)),a=n?n.headingLevel:0,s=0===a?0:this._headings.reduce(((e,t)=>e&&e.headingLevel>t.headingLevel?e:t)).headingLevel;for(const n of this._headings){if(e>0&&(0==n.headingLevel||n.headingLevel>e))continue;const o=n.headingLevel?n.headingLevel-a:s+1;if(t>=0&&o>t)continue;const r=document.createElement("a");r.heading=n,n.id?r.href=`#${n.id}`:r.addEventListener("click",this.scrollToHeading.bind(this,n)),a>0&&o>0&&(r.style.paddingInlineStart=.5*o+"rem"),r.textContent=n.headingTitle,i.push(r)}}}n.replaceChildren(...i),0===i.length?this.classList.add("empty"):this.classList.remove("empty")}scrollToHeading(e){e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.location.hash&&window.location.hash.length&&history.replaceState(null,"",window.location.pathname)}}export{e as TavenemContentsHTMLElement};
//# sourceMappingURL=tavenem-contents.js.map
