{
  "version": 3,
  "sources": ["../../../../../src/assets/scripts/tavenem-dialog.ts"],
  "sourcesContent": ["export interface Dialog extends HTMLDialogElement {\n    dragStartX: number | undefined;\n    dragStartY: number | undefined;\n    dragCurrentX: number | undefined;\n    dragCurrentY: number | undefined;\n    dragFinalX: number | undefined;\n    dragFinalY: number | undefined;\n    dragInertiaOvercome: boolean | undefined;\n}\n\nlet draggedDialog: Dialog | undefined;\n\nexport function initialize(dialog: HTMLDialogElement) {\n    if (!dialog) {\n        return;\n    }\n    const headers = dialog.getElementsByClassName('header');\n    if (headers\n        && headers.length\n        && headers[0] instanceof HTMLElement) {\n        headers[0].addEventListener('pointerdown', onPointerDown);\n        document.addEventListener('pointerup', stopDragging);\n        document.addEventListener('pointermove', drag);\n    }\n\n    dialog.addEventListener('keydown', onKeyDown.bind(dialog));\n    position(dialog);\n}\n\nexport function initializeId(id: string) {\n    const dialog = document.getElementById(id);\n    if (dialog instanceof HTMLDialogElement) {\n        initialize(dialog);\n    }\n}\n\nexport function showModal(dialog: HTMLDialogElement) {\n    dialog.showModal();\n    position(dialog);\n}\n\nfunction drag(e: PointerEvent) {\n    if (!draggedDialog\n        || draggedDialog.dragStartX == null\n        || draggedDialog.dragStartY == null) {\n        return;\n    }\n\n    e.preventDefault();\n\n    if (!draggedDialog.dragInertiaOvercome) {\n        if (Math.abs(e.clientX - draggedDialog.dragStartX) > 10\n            || Math.abs(e.clientY - draggedDialog.dragStartY) > 10) {\n            draggedDialog.dragInertiaOvercome = true;\n        } else {\n            return;\n        }\n    }\n\n    const containerWidth = draggedDialog.offsetParent?.clientWidth || window.innerWidth;\n    const dialogWidth = draggedDialog.clientWidth;\n    const containerHeight = draggedDialog.offsetParent?.clientHeight || window.innerHeight;\n    const dialogHeight = draggedDialog.clientHeight;\n\n    const left = Math.min(\n        Math.max(\n            0,\n            (draggedDialog.dragFinalX || 0) + (e.clientX - draggedDialog.dragStartX)),\n        containerWidth - dialogWidth);\n\n    const top = Math.min(\n        Math.max(\n            0,\n            (draggedDialog.dragFinalY || 0) + (e.clientY - draggedDialog.dragStartY)),\n        containerHeight - dialogHeight);\n\n    draggedDialog.dragCurrentX = left;\n    draggedDialog.dragCurrentY = top;\n\n    draggedDialog.style.left = left + 'px';\n    draggedDialog.style.top = top + 'px';\n}\n\nfunction onKeyDown(this: HTMLDialogElement, event: KeyboardEvent) {\n    if (event.key === \"Escape\" && this.open) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.close();\n    }\n}\n\nfunction onPointerDown(e: PointerEvent) {\n    if (!(e.target instanceof Element)\n        || e.target instanceof HTMLAnchorElement\n        || e.target instanceof HTMLButtonElement\n        || e.target instanceof HTMLInputElement\n        || e.target instanceof HTMLSelectElement\n        || e.target instanceof HTMLTextAreaElement) {\n        return;\n    }\n    if (e.target.hasPointerCapture(e.pointerId)) {\n        e.target.releasePointerCapture(e.pointerId);\n    }\n    if (!(e.currentTarget instanceof HTMLElement)\n        || !(e.currentTarget.parentElement instanceof HTMLElement)\n        || !(e.currentTarget.parentElement.parentElement instanceof HTMLDialogElement)) {\n        return;\n    }\n    e.preventDefault();\n    draggedDialog = e.currentTarget.parentElement.parentElement as Dialog;\n    draggedDialog.dragStartX = e.clientX;\n    draggedDialog.dragStartY = e.clientY;\n}\n\nfunction position(dialog: HTMLDialogElement) {\n    if (!dialog) {\n        return;\n    }\n    const d = dialog as Dialog;\n    const boundingRect = d.getBoundingClientRect();\n    d.dragFinalX = (window.visualViewport?.offsetLeft || window.document.documentElement.offsetLeft)\n        + ((window.visualViewport?.width || window.document.documentElement.clientWidth) / 2)\n        - (boundingRect.width / 2);\n    d.dragFinalY = (window.visualViewport?.offsetTop || window.document.documentElement.offsetTop)\n        + ((window.visualViewport?.height || window.document.documentElement.clientHeight) / 2)\n        - (boundingRect.height / 2);\n    d.style.left = `${d.dragFinalX}px`;\n    d.style.top = `${d.dragFinalY}px`;\n}\n\nfunction stopDragging() {\n    if (draggedDialog) {\n        draggedDialog.dragFinalX = draggedDialog.dragCurrentX;\n        draggedDialog.dragFinalY = draggedDialog.dragCurrentY;\n        delete draggedDialog.dragStartX;\n        delete draggedDialog.dragStartY;\n        delete draggedDialog.dragCurrentX;\n        delete draggedDialog.dragCurrentY;\n        draggedDialog = undefined;\n    }\n}"],
  "mappings": "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",
  "names": ["draggedDialog", "initialize", "dialog", "headers", "onPointerDown", "stopDragging", "drag", "onKeyDown", "position", "initializeId", "id", "showModal", "e", "containerWidth", "dialogWidth", "containerHeight", "dialogHeight", "left", "top", "event", "d", "boundingRect"]
}
